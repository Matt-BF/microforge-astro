---
import { useStoryblokApi } from "@storyblok/astro";
import Layout from "../layouts/Layout.astro";

const storyblokApi = useStoryblokApi();
const { data } = await storyblokApi.get("cdn/stories", {
  version: import.meta.env.DEV ? "draft" : "published",
  content_type: "blogPost",
});
const posts = data.stories.map((story) => {
  return {
    title: story.content.title,
    date: new Date(story.published_at).toLocaleDateString("en-US", {
      dateStyle: "full",
    }),
    description: story.content.description,
    slug: story.full_slug,
  };
});
---

<Layout title="Microforge - O futuro da Biologia Molecular passa por aqui!">
  <h1>MConfira nossos posts</h1>
  <ul>
    {
      posts.map((post) => (
        <li>
          <time>{post.date}</time>
          <a href={post.slug}>{post.title}</a>
          <p>{post.description}</p>
        </li>
      ))
    }
  </ul>
</Layout>
